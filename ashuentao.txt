/*Nathan Burdzel
  *CIS 190
  *Homework 4
  *Problem 3
  *Recursive solution for the map distance problem printing all possible routes
  *11/15/19
  */

/*Preprocessor directives*/
#include <stdio.h>

/*Defined constants*/
#define NUMBER_OF_CITIES 14
#define MAP_FILE_PATH "map.txt"
#define LONGEST_CITY_NAME 16
#define BUFFER 128

/*Function stubs*/
void loadFile(int map[NUMBER_OF_CITIES][NUMBER_OF_CITIES], int row, int col, FILE* fp);
void getInputs(char saveMe[BUFFER], char names[NUMBER_OF_CITIES][LONGEST_CITY_NAME], int* fromCity, int* toCity);
void findPaths(int currentCity, int nextCity, int goalCity, int distance, int cityCount, int visitedCities[NUMBER_OF_CITIES], int map[NUMBER_OF_CITIES][NUMBER_OF_CITIES], char cityNames[NUMBER_OF_CITIES][LONGEST_CITY_NAME]);
void printPath(int visitedCities[NUMBER_OF_CITIES], int toPrint, int cityCount, int distance, char cityNames[NUMBER_OF_CITIES][LONGEST_CITY_NAME]);
int findValueInArray(int array[NUMBER_OF_CITIES], int index, int value);

int main(void){
  /*Declare variables*/
  int map[NUMBER_OF_CITIES][NUMBER_OF_CITIES] = {{0}};
  int visitedCities[NUMBER_OF_CITIES] = {0};
  int fromCity = 1;
  int toCity = 2;
  char names[NUMBER_OF_CITIES][LONGEST_CITY_NAME] = {"Seattle\0", "San Francisco\0", "Los Angeles\0", "Dallas\0", "New Orleans\0", "Miami\0", "Washington D.C.\0", "New York City\0", "Milwaukee\0", "Chicago\0", "Minneapolis\0", "Oklahoma City\0", "Phoenix\0", "Las Vegas\0"};
  FILE *fp;
  char saveMe[BUFFER];

  /*Load the map from file*/
  fp = fopen(MAP_FILE_PATH, "r");
  loadFile(map, 0, 0, fp);
  fclose(fp);

  /*Get input from the user on which two cities they are traveling between*/
  getInputs(saveMe, names, &fromCity, &toCity);

  /*Find and print the paths between them*/
  findPaths(fromCity, 0, toCity, 0, 0, visitedCities, map, names);

  return 0;
}

/*Recursively fills the map with data from the map file*/
void loadFile(int map[][NUMBER_OF_CITIES], int row, int col, FILE* fp){
  /*If the last row was checked return*/
  if (row >= NUMBER_OF_CITIES)
    return;
  /*If the last item in the column was checked load the next row*/
  if (col >= NUMBER_OF_CITIES)
    loadFile(map, row + 1, 0, fp);
  /*Load the item then the rest of the row*/
  else{
  fscanf(fp, "%d", &map[row][col]);
  loadFile(map, row, col + 1, fp);
  }
}

/*Gets input on the city the user is travling from and to*/
void getInputs(char saveMe[BUFFER], char names[][LONGEST_CITY_NAME], int* fromCity, int* toCity){
  /*Declare local variables*/
  int i;
  /*Get the number of the first city*/
  do{
    printf("Please enter the number corresponding to your desired starting city\n");
    for(i = 0; i < NUMBER_OF_CITIES; i++){
      printf("%d: %s\n", i + 1, names[i]);
    }
    fgets(saveMe, BUFFER, stdin);
    *fromCity = atoi(saveMe);

    /*Validate input*/
    if(*fromCity <= 0 || (*fromCity >= NUMBER_OF_CITIES))
      printf("Please choose a city in the range");
  }while (*fromCity <= 0 || (*fromCity >= NUMBER_OF_CITIES));

  /*Get the number for the second city*/
  do{
    printf("Please enter the number corresponding to your desired starting city\n");
    for(i = 0; i < NUMBER_OF_CITIES; i++){
      printf("%d: %s\n", i + 1, names[i]);
    }
    fgets(saveMe, BUFFER, stdin);
    *toCity = atoi(saveMe);

    /*Validate input*/
    if(*fromCity <= 0 || (*fromCity >= NUMBER_OF_CITIES))
      printf("Please choose a city in the range");
  }while (*fromCity <= 0 || (*fromCity >= NUMBER_OF_CITIES));

}


void findPaths(int currentCity, int nextCity, int goalCity, int distance, int cityCount, int visitedCities[], int map[][NUMBER_OF_CITIES], char cityNames[][LONGEST_CITY_NAME]){
  printf("Hi");
  /*Otherwise add this city to the list of visited cities*/
  visitedCities[currentCity] = cityCount;

  /*If this is the goal city print out the path of cities that led to it, remove it from the list of visited cities and return*/
  if(currentCity == goalCity){
    printPath(visitedCities, 0, cityCount, distance, cityNames);
    visitedCities[currentCity] = 0;
    return;
  }
  /*Check to see if all connections from this city have been tried*/
  if(nextCity >= NUMBER_OF_CITIES){
    visitedCities[currentCity] = 0;
    return;
  }
  /*If the next city to visit was already visited try again with the next  next city*/
  if(visitedCities[nextCity]){
    findPaths(currentCity, nextCity + 1, goalCity, distance, cityCount, visitedCities, map, cityNames);
  }else{
    findPaths(nextCity, 0, goalCity, distance + map[currentCity][nextCity], cityCount + 1, visitedCities, map, cityNames);
  }
}

/*Prints the order that the cities were visited in*/
void printPath(int visitedCities[], int toPrint, int cityCount, int distance, char cityNames[][LONGEST_CITY_NAME]){
  /*If this is the first city print out ain introductor message*/
  if(toPrint == 0)
    printf("To complete your trip you need to visit %d cities over a distance of %d miles.");
  /*Print out which city you visited*/
  printf("City number %d in your trip is %s", toPrint, cityNames[findValueInArray(visitedCities, 0, toPrint)]);
  /*Print the rest of the cities*/
  printPath(visitedCities, toPrint + 1, cityCount, distance, cityNames);
}

/*Returns the index of a value in an array given that the value exists in the array*/
int findValueInArray(int array[], int index, int value){
  /*If the value was found return it*/
  if(array[index] == value)
    return index;
  /*Check the rest of the array*/
  return findValueInArray(array, index + 1, value);
}